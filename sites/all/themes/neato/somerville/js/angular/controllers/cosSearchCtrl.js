!function(){"use strict";var e,t=function(e,t,a,n,s){function i(){l(),d(),u()}function r(e){e.data.results=e.data.results||[],q.searchModel.data.source=e.data.results,c(e.data.availableFacets),q.searchModel.data.availableFacets=e.data.availableFacets,s.setDataSize(q.searchModel.pagination,e.data.results)}function o(e){}function c(e){angular.forEach(e,function(e,t){a.updateSelectedFacets(e.facets,q.searchModel.query[e.key])})}function l(){if(location.search.length){var t=e("searchMapper")(location.search);angular.isDefined(t.contentType)&&(t.contentType=t.contentType.split(",")),angular.isDefined(t.department)&&(t.department=t.department.split(",")),angular.extend(q.searchModel.query,t)}}function u(){p=t.$watchCollection(angular.bind(this,function(){return q.searchModel.query.contentType}),d),f=t.$watchGroup([angular.bind(this,function(){return q.searchModel.query.timestampEnd}),angular.bind(this,function(){return q.searchModel.query.timestampStart})],h),y=t.$watchCollection(angular.bind(this,function(){return q.searchModel.query.department}),d),m=t.$watchCollection(angular.bind(this,function(){return q.searchModel.pagination}),d),M=t.$watchGroup([angular.bind(this,function(){return q.searchModel.query.includePDFs}),angular.bind(this,function(){return q.searchModel.query.keyword}),angular.bind(this,function(){return q.searchModel.query.sorting}),angular.bind(this,function(){return q.searchModel.query.timestampEnd}),angular.bind(this,function(){return q.searchModel.query.timestampStart})],d),v=t.$watch(angular.bind(this,function(){return q.searchModel.query.sorting}),g)}function d(){n.search(q.searchModel.query).then(r,o)}function h(){q.hasDateSelected=!1,(q.searchModel.query.timestampEnd||q.searchModel.query.timestampStart)&&(q.hasDateSelected=!0)}function g(){var e,t={active:"search-results__sorting-option--is-active",ascending:"search-results__sorting-option--is-ascending",descending:"search-results__sorting-option--is-descending"};q.sortingOptionClasses.date=[],q.sortingOptionClasses.relevance=[],e=q.searchModel.query.sorting.indexOf("Relevance")!=-1?"relevance":"date",q.sortingOptionClasses[e].push(t.active),q.searchModel.query.sorting.indexOf("-")==-1?q.sortingOptionClasses[e].push(t.ascending):q.sortingOptionClasses[e].push(t.descending)}var p,f,y,m,M,v,q=this;this.searchModel={data:{source:[],availableFacets:{contentType:{displayName:"",facets:[]},department:{displayName:"",facets:[]}}},pagination:{currentPage:1,lastPage:1,perPage:10,totalItems:0},query:{contentType:[],department:[],domain:"City of Somerville",includePDFs:!1,keyword:"",sorting:"Date",timestampEnd:"",timestampStart:""}},this.domainOptions=[{value:"City of Somerville",display:"SomervilleMA.gov"},{value:"ParkSomerville",display:"ParkSomerville"},{value:"Domain Name",display:"Domain Name"}],this.calendarModel={timestampStart:{format:"MM/dd/yyyy",isOpen:!1},timestampEnd:{format:"MM/dd/yyyy",isOpen:!1}},this.sortingOptionClasses={date:[],relevance:[]},this.hasDateSelected=!1,this.showFacets=!1,this.showOverflow=!1,this.changePage=function(e){s.changePage(q.searchModel.pagination,e)},this.firstPage=function(){s.firstPage(q.searchModel.pagination)},this.lastPage=function(){s.lastPage(q.searchModel.pagination)},this.nextPage=function(){s.nextPage(q.searchModel.pagination)},this.previousPage=function(){s.previousPage(q.searchModel.pagination)},this.loadMore=function(){s.loadMore(q.searchModel.pagination,10)},this.sortBy=function(e){this.searchModel.query.sorting=(this.searchModel.query.sorting===e?"-":"")+e},this.toggleFacetItem=function(e,t){a.toggleFacetItem(e.value,q.searchModel.query[t.key])},this.clearFacet=function(e){q.searchModel.query[e.key]=[],angular.forEach(e.facets,function(e,t){e.selected=!1})},this.clearDateFacet=function(){q.searchModel.query.timestampEnd="",q.searchModel.query.timestampStart=""},this.openCalendar=function(e){this.showOverflow=!0,angular.forEach(this.calendarModel,function(t,a){e.currentTarget.htmlFor==a?t.isOpen=!t.isOpen:t.isOpen=!1})},this.toggleFacetDisplay=function(){this.showFacets=!this.showFacets,this.showFacets||(this.showOverflow=!1)},i()};try{e=angular.module("cosSearchControllers")}catch(a){e=angular.module("cosSearchControllers",[])}e.controller("cosSearchCtrl",["$filter","$scope","cosFacetService","cosSearchService","cosPagerLogic",t])}();
//# sourceMappingURL=../../maps/angular/controllers/cosSearchCtrl.js.map
